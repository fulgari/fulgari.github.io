{"pageProps":{"post":{"title":"技术优化小记（Web Vitals、兼容性等）","date":"2023-08-27","slug":"improve-web-vitals","content":"<h1>技术优化</h1>\n<p>主要分为UX、DX两个方面，优化用户体验和开发体验。</p>\n<h2>保持输入</h2>\n<p>保持对前端技术的灵敏嗅觉，了解新技术趋势（如swc、fresh、astro、qwik、million、lexical、turbopack、esbuild等新技术），并结合实际场景进行落地。</p>\n<h2>优化Web Vitals</h2>\n<ul>\n<li>提升FCP（<em>优&#x3C;1.8s&#x3C;差强人意&#x3C;3s&#x3C;差</em>）：\n<ul>\n<li>动态加载组件</li>\n<li>lazy-load/CDN img</li>\n<li>h2/h3</li>\n<li>用webpack删代码treeShake+分包splitChunks</li>\n<li>并行请求</li>\n<li>文本内容尽早展示（font-display: swap）</li>\n<li>善用缓存（cache-control/expires/etag/last-modified）</li>\n<li>brotli格式压缩（nginx 配置）</li>\n<li>Inline CSS</li>\n<li>Inline Img（base64）</li>\n<li>CDN加载公共js</li>\n</ul>\n</li>\n<li>提升CLS（<em>impact×distance，优&#x3C;0.1&#x3C;差强人意&#x3C;0.25&#x3C;差</em>）：\n<ul>\n<li>善用亲属关系hint（rel=dns-prefetch/prefetch/preload/preconnect）</li>\n<li>WebP格式</li>\n</ul>\n</li>\n<li>提升FID（<em>优&#x3C;100ms&#x3C;差强人意&#x3C;200ms&#x3C;差</em>）：\n<ul>\n<li>将大的同步操作拆分为小的异步操作</li>\n<li>使用SSR</li>\n<li>对耗时请求设置支持中断和超时</li>\n<li>复杂计算使用 Web Worker</li>\n</ul>\n</li>\n</ul>\n<h2>优化兼容性</h2>\n<ul>\n<li>成体系的CSS兼容方案\n<ul>\n<li>使用css预处理器/后处理器：前者提高代码编写的便捷性，后者可以用autoprefixer完善前缀等</li>\n<li>animation动画：transform不能同时设置 scale/rotate 和 opacity，需要用两个动画曲线分别处理</li>\n<li>居中：设计导出的动画没有考虑小屏机的屏幕尺寸（小于375*812）导致absolute布局不居中，使用多一层div包裹，设置相对定位，宽高100%</li>\n<li>动画卡顿：ios上，避免使用step(1)的动画，有卡顿感，而应该改为linear，通过动画曲线设置渐变</li>\n<li>字体渲染出现白边：对动画文字格栅化渲染问题，可以通过添加will-change优化相应的文字动画；另外也可以通过加上clip-path: inset(1px); 裁剪解决</li>\n<li>iphone非标准底部，需要添加 iphone对应的变量：env(safe-area-inset-bottom) 但在ios9以下不生效，需要确保添加了fallback的值兼容</li>\n<li>查文档手册，尽量避免使用grid、gap等可能有兼容性问题的属性</li>\n</ul>\n</li>\n<li>Mixin\n<ul>\n<li>字体渐变</li>\n<li>0.5px的边框</li>\n</ul>\n</li>\n</ul>\n"}},"__N_SSG":true}